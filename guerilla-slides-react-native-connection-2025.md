<img src="https://upload.wikimedia.org/wikipedia/commons/8/80/Che_Guevara_-_Guerrillero_Heroico_by_Alberto_Korda.jpg" alt="Che Guevara" style="height:100px;"/>

## Wrapping C++ and Python libraries for JavaScript

### The guerilla-slides-react-native-connection-2025

<img src="https://upload.wikimedia.org/wikipedia/commons/2/2a/La_Guerra_de_Guerrillas_%28ediciÃ³n_de_1961%29.png" alt="Guerilla Warfare" style="height:200px;"/>

[comment]: # (!!!)

<img src="https://raw.githubusercontent.com/mmomtchev/guerilla-slides/refs/heads/main/C%2B%2B_in_Javascript.png" alt="C++ in JavaScript" style="height:70vh;"/>

[comment]: # (!!!)

JavaScript has become the new universal language - and it happened almost by accident
 * because of all the R&D that went into highly efficient interpreters
 * because it allows to share backend and frontend code

[comment]: # (!!!)

JavaScript is notoriously difficult to interoperate with other languages.

So, for the last two decades, people have been trying to rewrite all existing software in JavaScript - there was simply no other way around it.

## But is this actually feasible?

[comment]: # (!!!)

I have authored or co-authored the bindings of four major C++ libraries for JavaScript:

* `GDAL` - only Node.js
* `ImageMagick` - both browser and Node.js, the first SWIG JSE project, about 2 man-months
* `ffmpeg` - only Node.js - the first `nobind17` project, 
* `PROJ` - both browser and Node.js

Rewriting these in JavaScript is a monumental task.

[comment]: # (!!!)

Automatically generating wrappers for high-level interpreted languages by compiling the C/C++ header files is a solved problem: it is called 

# SWIG

and it exists since the 1990s.

However until 2024, JavaScript support was very rudimentary, covered only Node.js and wasn't really updated since the Node.js 0.x era.

[comment]: # (!!!)

## The Holy Grail of JavaScript/C++ interoperability

```shell
git clone https://github.com/ImageMagick/ImageMagick
abracadabra ImageMagick
```

then

```js
import { Magick } from '@abracadabra/ImageMagick';
```

And it works both in Node.js and in the browser!

[comment]: # (!!!)

This has been achieved for Python libraries!

It is called `pymport`:

```
npm install pymport
npx pympip3 install numpy
```

then

```js
const { pymport, proxify } = require('pymport');
const np = proxify(pymport('numpy'));

const a = np.arange(15).reshape(3, 5);
const b = np.ones([2, 3], { dtype: np.int16 });
```

[comment]: # (!!!)

### ...For C++ we are not there yet
*but at least we are going in the right direction*

Today, there are two choices:

### SWIG JavaScript Evolution
  - Very powerful, supports both Node.js and WASM
    but has a very steep learning curve 

### `nobind17` - `pybind11`-like
  - Very simple to use, does not require any special
    knowledge beyond C++ but it has its limits and
    supports only C++ for Node.js

[comment]: # (!!!)

* `GDAL`, my first project, as a co-author, was completely hand-written bindings - it costed more than 1 man-year
* `ImageMagick`, the first SWIG JSE project, took about 1 man-month, 400k lines of C++ code generated from 800 lines of SWIG JSE code
* `ffmpeg`, the first `nobind17` project - about 2 man-weeks to get it to mostly working status
* `PROJ`, the second SWIG JSE project - about 2 man-weeks

The cost savings are tremendous!

[comment]: # (!!!)

* The bindings support both synchronous and asynchronous calls - both in Node.js and in the browser *(async in the browser requires COOP/COEP)*
* `import`ing is completely automatic - just as if this was JavaScript - the bundler picks up either the browser WASM version or the Node.js native version
* The TypeScript types are autogenerated
* The C++ STL is replaced by methods that have native JavaScript feel

[comment]: # (!!!)

Interfacing the two languages is not enough!

End-users expect `npm` packages - which must be so seamless, that the developer does not need to know about the C++

*time to ditch `node-gyp`*

## Enter the `hadron` build system

[comment]: # (!!!)

# `hadron`

* `meson`-based build system which is compatible with CMake and autotools
* `xpm`-orchestrator for seamless integration with `conan` and a built-in C++ compiler in an `npm` package

ImageMagick comes prebuilt with more than 20 libraries - on Linux, macOS and Windows, and WASM - and it can rebuild itself upon installation, pulling the libraries from `conan` and using its own C++ compiler!

[comment]: # (!!!)

I am unemployed and homeless software engineer living on the street on social welfare and working full-time on open source in my van using solar panels.

I am currently the target of a huge extortion, that involves many of the largest IT companies in the world - including Google, X, Microsoft and Facebook - as well as the French police - about a series of irregular criminal and civil cases with sexual motivation.

I chose to live on the street with almost no money instead of accepting a job in a criminal company willing to help cover up this affair since I consider this to be a more meaningful use of my life.

[comment]: # (!!!)

* SWIG JSE - https://github.com/mmomtchev/swig
* `nobind17`- https://www.npmjs.com/package/nobind17
* `hadron` - https://github.com/mmomtchev/hadron
* `magickwand.js` - https://www.npmjs.com/package/magickwand.js
* `gdal-async` - https://www.npmjs.com/package/gdal-async
* `node-ffmpeg` - https://www.npmjs.com/package/@mmomtchev/ffmpeg
* `proj.js` - https://www.npmjs.com/package/proj.js

[comment]: # (!!!)

As a side note, you may have noticed that my flyers reference the dotJS 2024 conference.

Alas, the flyers for this conference were conveniently *"lost"* by DPD last week.

This event was accompanied by a number of notifications that I received on X by fake DPD accounts and X themselves.

It seems that the people behind the extortion had promised to everyone who helped them to drive me away from the React Native community in 2022-2023, to stop this presentation.

[comment]: # (!!!)

# For great justice!

<img src="https://i.kym-cdn.com/photos/images/newsfeed/001/553/629/3c9.jpg" alt="All your base are belong to us" style="height:500px;"/>
